(this["webpackJsonpcompare-archives"]=this["webpackJsonpcompare-archives"]||[]).push([[0],{106:function(e,t,n){},113:function(e,t,n){"use strict";n.r(t);var a=n(0),c=n.n(a),r=n(17),i=n.n(r),s=(n(67),n(44)),o=n(15),l=n(8),u=n(28),h=n.n(u),d=(n(80),n(12)),j=n.n(d),f=n(21);function b(){return(b=Object(f.a)(j.a.mark((function e(t){var n,a;return j.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n="/es-title-pk-suggest/?q=".concat(t),e.next=3,fetch(n,{credentials:"include"});case 3:return a=e.sent,e.next=6,a.json();case 6:return e.abrupt("return",e.sent);case 7:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function g(e){return m.apply(this,arguments)}function m(){return(m=Object(f.a)(j.a.mark((function e(t){var n,a,c,r;return j.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n={archives:t},a=h.a.stringify(n,{indices:!1}),c="/api/?".concat(a),e.next=5,fetch(c,{credentials:"include"});case 5:return r=e.sent,e.next=8,r.json();case 8:return e.abrupt("return",e.sent);case 9:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function O(){return(O=Object(f.a)(j.a.mark((function e(t,n){var a,c,r,i;return j.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a={algos:t,pk:n},c=h.a.stringify(a,{indices:!1}),r="/compare-archives/?".concat(c),e.next=5,fetch(r,{credentials:"include"});case 5:return i=e.sent,e.next=8,i.json();case 8:return e.abrupt("return",e.sent);case 9:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function p(e,t,n){return v.apply(this,arguments)}function v(){return(v=Object(f.a)(j.a.mark((function e(t,n,a){var c,r;return j.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return c="/live-image-thumbnail/".concat(t,"/").concat(n,"/?base64=1&full=").concat(a?"1":""),e.next=3,fetch(c,{credentials:"include"});case 3:return r=e.sent,e.next=6,r.text();case 6:return e.abrupt("return",e.sent);case 7:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var x=n(115),y=n(116),w=n(117),k=n(118),N=n(6),M=n.n(N),C=n(57),S=n.n(C);n(83);function I(e){var t=Math.log(e)/Math.log(1024)|0,n=(e/Math.pow(1024,t)).toFixed(2);return"".concat(n," ").concat(0===t?"bytes":"".concat("KMGTPEZY"[t-1],"B"))}var E=["language","artist","group","parody","character","female","male","mixed","other","misc"];function A(e){var t=[];E.forEach((function(n){var a=e.filter((function(e){return e.startsWith("".concat(n,":"))})).map((function(e){return e.replace("".concat(n,":"),"")})).sort();a.length>0&&t.push([n,a])}));var n=e.filter((function(e){return!E.find((function(t){return e.startsWith("".concat(t,":"))}))})).sort();return n.length>0&&t.push(["",n]),t}var P=n(43),D=n(114),F=n(2);var L=function(e){var t=e.imageRenderer,n=e.buttonContent,a=c.a.useState(!1),r=Object(l.a)(a,2),i=r[0],s=r[1],o=c.a.useState(!1),u=Object(l.a)(o,2),h=u[0],d=u[1],j=c.a.useState(),f=Object(l.a)(j,2),b=f[0],g=f[1];return c.a.useEffect((function(){i&&!b&&(d(!0),t().then((function(e){g(e),d(!1)})))}),[b,t,i]),Object(F.jsx)(P.Popover,{isOpen:i,padding:5,positions:["right","left","bottom","top"],content:function(e){var t=e.position,n=e.childRect,a=e.popoverRect;return Object(F.jsx)(P.ArrowContainer,{position:t,childRect:n,popoverRect:a,arrowColor:"green",arrowSize:10,arrowStyle:{opacity:1},className:"popover-arrow-container",arrowClassName:"popover-arrow",children:!h&&b?b:Object(F.jsx)(D.a,{color:"primary"})})},children:Object(F.jsx)("button",{type:"button",className:"btn btn-primary btn-sm",onClick:function(){return s(!i)},children:n})})},J=function(e,t){return(null===t||void 0===t?void 0:t.current)?"current-highlight":(null===t||void 0===t?void 0:t.highlight)?"hash-highlight":e&&e.other.length>0?"hash-match":""},R=function(e){return e?S.a.unix(e).format("MM-DD-YYYY"):"No"};function T(e){var t=e.data,n=e.archives,a=e.loading,r=e.showMatchesOnly,i=e.showNonMatchesOnly,s=e.fetchFull,o=e.showImagesOnTop,u=e.handleAddImage,h=c.a.useState(new Map),d=Object(l.a)(h,2),b=d[0],g=d[1],m=c.a.useState(new Map),O=Object(l.a)(m,2),v=O[0],N=O[1],C=c.a.useState(new Map),S=Object(l.a)(C,2),E=S[0],P=S[1],D=c.a.useCallback((function(){var e=new Map,n=new Map;Object.keys(t).forEach((function(a){return Object.keys(t[a].images).forEach((function(c){var r={matchedImages:0};Object.keys(t[a].images[c]).forEach((function(n){var i=[];if(Object.keys(t[a].images).filter((function(e){return e!==c})).forEach((function(e){Object.keys(t[a].images[e]).filter((function(r){return t[a].images[e][r]===t[a].images[c][n]})).forEach((function(t){return i.push({algorithm:a,archive:e,image:t})}))})),i.length>0){var s=JSON.stringify({algorithm:a,archive:c,image:n});e.set(s,{other:i})}r.matchedImages+=i.length}));var i=JSON.stringify({algorithm:a,archive:c});n.set(i,r)}))})),N(e),P(n)}),[t]),T=c.a.useCallback((function(){var e=new Map;Object.keys(t).forEach((function(n){return Object.keys(t[n].images).forEach((function(a){return Object.keys(t[n].images[a]).forEach((function(t){var c=JSON.stringify({algorithm:n,archive:a,image:t});e.set(c,{current:!1,highlight:!1})}))}))})),g(e)}),[t]);c.a.useEffect((function(){D()}),[D,t]),c.a.useEffect((function(){T()}),[T,t]);var Y=function(e,t){var n=v.get(e),a=b.get(e);void 0===a?b.set(e,{current:t,highlight:!1}):(a.highlight=!1,a.current=t,b.set(e,a)),n&&n.other.forEach((function(e){var n=JSON.stringify(e),a=b.get(n);void 0===a?b.set(n,{current:!1,highlight:t}):(a.highlight=t,a.current=!1,b.set(n,a))})),g(new Map(b))},z=function(e){return e?e.other.map((function(e){return Object(F.jsx)("span",{className:"mr-1",children:"A: ".concat(e.archive,", I: ").concat(e.image)},"".concat(e.archive,"-").concat(e.image))})):[]},_=function(e){var t=E.get(e);return t?t.matchedImages:0},B=function(){var e=Object(f.a)(j.a.mark((function e(t,n,a){var c;return j.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,p(t,n,a);case 2:return c=e.sent,e.abrupt("return",Object(F.jsx)("img",{alt:n,src:"".concat(c)}));case 4:case"end":return e.stop()}}),e)})));return function(t,n,a){return e.apply(this,arguments)}}();return Object(F.jsx)(F.Fragment,{children:a?Object(F.jsx)("div",{className:"text-center",children:"Loading results, might take a while depending on algorithm..."}):Object(F.jsxs)(x.a,{bordered:!0,size:"sm",className:"results-table",children:[Object(F.jsxs)("thead",{children:[Object(F.jsx)("tr",{children:Object.keys(t).map((function(e){return Object(F.jsx)("th",{className:"text-center",colSpan:Object.keys(t[e].images).length,children:e},e)}))}),Object(F.jsx)("tr",{children:Object.keys(t).map((function(e){return Object.keys(t[e].images).map((function(t){var a=n.find((function(e){return e.id.toString()===t}));return a?Object(F.jsx)("th",{className:"mid-content",children:Object(F.jsxs)(y.a,{children:[Object(F.jsx)(y.a,{left:!0,className:"mr-2",children:a.thumbnail?Object(F.jsx)("img",{src:a.thumbnail,alt:a.title}):null}),Object(F.jsxs)(y.a,{body:!0,children:[Object(F.jsx)(y.a,{heading:!0,children:a.title}),Object(F.jsxs)("div",{children:["Link: ",Object(F.jsx)("a",{href:a.url,children:"/archive/".concat(t,"/")})," | ","Images: ".concat(a.filecount)," | ","Size: ".concat(I(a.filesize))," | ","Matches: ".concat(_(JSON.stringify({algorithm:e,archive:t})))]}),Object(F.jsxs)("div",{children:["Added: ".concat(R(a.create_date?a.create_date:a.public_date))," | ","Posted: ".concat(R(a.posted))," | ","Public: ".concat(R(a.public_date))]}),Object(F.jsx)("div",{children:A(a.tags).map((function(e){return Object(F.jsx)("div",{children:Object(F.jsx)(w.a,{children:Object(F.jsxs)(k.a,{children:[e[0]?Object(F.jsx)("div",{className:"mr-1",children:e[0]+":"}):"",e[1].map((function(e){return Object(F.jsx)("div",{className:"tag-element mr-1",children:e},e)}))]})})},e[0])}))})]})]})},t):null}))}))})]}),Object(F.jsx)("tbody",{children:Object(F.jsx)("tr",{children:Object.keys(t).map((function(e){return Object.keys(t[e].images).map((function(n){return Object(F.jsx)("td",{className:"shaCell",children:Object(F.jsx)("ul",{className:"list-group",children:Object.keys(t[e].images[n]).map((function(a){var c=JSON.stringify({algorithm:e,archive:n,image:a}),l=v.get(c);return r&&!(l&&l.other.length>0)||i&&void 0!==l&&0!==l.other.length?null:Object(F.jsxs)("li",{className:M()("list-group-item",J(l,b.get(c))),onMouseEnter:function(){return Y(c,!0)},onMouseLeave:function(){return Y(c,!1)},children:[o?Object(F.jsx)("button",{type:"button",className:"btn btn-primary btn-sm",onClick:function(){return B(n,a,s).then((function(e){return u(e,n,a)}))},children:a}):Object(F.jsx)(L,{buttonContent:a,imageRenderer:function(){return B(n,a,s)}}),": ",Object(F.jsx)("span",{children:t[e].images[n][a]}),l&&l.other.length>0?Object(F.jsxs)("span",{children:[" > "," ",z(l)]}):""]},a)})).filter((function(e){return null!=e}))})},n)}))}))})})]})})}var Y=n(58),z={menu:function(e,t){return Object(o.a)(Object(o.a)({},e),{},{color:t.selectProps.menuColor})}};var _=function(e){var t=e.algorithms,n=e.availableAlgorithms,a=e.selectOption,c=e.isLoading;return Object(F.jsx)(Y.a,{value:t.map((function(e){return{value:e,label:e}})),isClearable:!0,isDisabled:c,isMulti:!0,onChange:function(e){a(e.map((function(e){return e.value})))},options:n.map((function(e){return{value:e,label:e}})),noOptionsMessage:function(){return null},placeholder:"Choose Algorithms...",menuColor:"black",styles:z})},B=n(62),V=(n(106),{menu:function(e,t){return Object(o.a)(Object(o.a)({},e),{},{color:t.selectProps.menuColor})}});var W=function(e){var t=e.archives,n=e.isLoading,c=e.selectOption,r=Object(a.useState)(""),i=Object(l.a)(r,2)[1],s=Object(a.useState)(!1),o=Object(l.a)(s,2),u=o[0],h=o[1];return Object(F.jsx)(B.a,{isLoading:u||n,isDisabled:u||n,value:t,isClearable:!0,isMulti:!0,backspaceRemovesValue:!0,getOptionLabel:function(e){return"".concat(e.id,": ").concat(e.title)},getOptionValue:function(e){return e.id},loadOptions:function(e){h(!0);var t=function(e){return b.apply(this,arguments)}(e);return h(!1),t},onInputChange:function(e){i(e)},onChange:function(e){c(e.map((function(e){return e})))},noOptionsMessage:function(){return null},placeholder:"Choose Archives...",menuColor:"black",styles:V})},q=n(119),G=n(120),K=n(121),Q=n(61),U=(n(107),n(60)),X=n.n(U);var Z=function(){var e=c.a.useState({}),t=Object(l.a)(e,2),n=t[0],a=t[1],r=c.a.useState([]),i=Object(l.a)(r,2),u=i[0],d=i[1],j=c.a.useState([]),f=Object(l.a)(j,2),b=f[0],m=f[1],p=c.a.useState([]),v=Object(l.a)(p,2),x=v[0],y=v[1],w=c.a.useState({MatchesOnly:!1,NonMatchesOnly:!1}),k=Object(l.a)(w,2),N=k[0],M=k[1],C=c.a.useState(!1),S=Object(l.a)(C,2),I=S[0],E=S[1],A=c.a.useState([]),P=Object(l.a)(A,2),D=P[0],L=P[1],J=c.a.useState(!1),R=Object(l.a)(J,2),Y=R[0],z=R[1],B=c.a.useState(!1),V=Object(l.a)(B,2),U=V[0],Z=V[1],H=c.a.useState(null),$=Object(l.a)(H,2),ee=$[0],te=$[1],ne=c.a.useState(!1),ae=Object(l.a)(ne,2),ce=ae[0],re=ae[1],ie=c.a.useState(""),se=Object(l.a)(ie,2),oe=se[0],le=se[1],ue=c.a.useCallback((function(e){var t=e.algos,n=e.pk;t.length<1||n.length<1?a({}):(re(!0),function(e,t){return O.apply(this,arguments)}(t,n).then((function(e){a(e.results),re(!1),le("")})).catch((function(e){re(!1),le(e.message)})))}),[]);c.a.useEffect((function(){!function(){var e,t,n=h.a.parse(window.location.search,{ignoreQueryPrefix:!0});e=void 0!==n.algos?Array.isArray(n.algos)?n.algos.map((function(e){return e.toString()})):"string"===typeof n.algos?[n.algos]:["sha1"]:["sha1"],d(e),t=void 0!==n.archives?Array.isArray(n.archives)?n.archives.map((function(e){return e.toString()})):"string"===typeof n.archives?[n.archives]:[]:[];var a={MatchesOnly:!1,NonMatchesOnly:!1};void 0!==n.matchesOnly&&(a.MatchesOnly=!0),void 0!==n.nonMatchesOnly&&(a.NonMatchesOnly=!0),M(a),void 0!==n.fetchFull&&E(!0),void 0!==n.showOnTop&&z(!0),e.length<1||t.length<1||(re(!0),g(t).then((function(e){m(e),y(e),re(!1),le("")})).catch((function(e){re(!1),le(e.message)})))}()}),[]),c.a.useEffect((function(){ue({algos:u,pk:b.map((function(e){return e.id}))})}),[u,b,ue]);var he=c.a.useCallback((function(e){e.length<1?y([]):(re(!0),g(e).then((function(e){y(e),re(!1),le("")})).catch((function(e){re(!1),le(e.message)})))}),[]);c.a.useEffect((function(){U&&de(D)}),[D,U]);var de=function(e){if(e.length<2)return te(null),null;var t=new Image;t.src=e[0].image.props.src;var n=new Image;n.onload=function(){var e=t.height,a=t.width;if(0===t.height||0===n.height)return te(null),null;var c=document.createElement("canvas"),r=c.getContext("2d"),i=document.createElement("canvas"),s=i.getContext("2d");if(c.width=t.width,c.height=t.height,i.width=n.width,i.height=n.height,null===r||null===s)return te(null),null;r.drawImage(t,0,0),s.drawImage(n,0,0);var o=r.getImageData(0,0,t.width,t.height),l=s.getImageData(0,0,n.width,n.height),u=new ImageData(a,e);X()(o.data,l.data,u.data,a,e,{threshold:0});var h=document.createElement("canvas"),d=h.getContext("2d");if(h.width=a,h.height=e,null===d)return te(null),null;d.putImageData(u,0,0);var j=Object(F.jsx)("img",{src:h.toDataURL(),alt:"result"});te(j)},n.src=e[1].image.props.src};return Object(F.jsx)("main",{className:"App",children:Object(F.jsxs)("div",{children:[Object(F.jsx)(W,{archives:b,selectOption:function(e){m(e),he(e.map((function(e){return e.id})))},isLoading:ce}),Object(F.jsx)(_,{algorithms:u,selectOption:function(e){d(e)},availableAlgorithms:["sha1","phash","ahash","dhash","whash-haar","whash-db4","colorhash"],isLoading:ce}),oe?Object(F.jsx)("div",{className:"text-center",children:oe}):null,Object(F.jsxs)(q.a,{children:[Object(F.jsx)(G.a,{children:"Options"}),Object(F.jsxs)("div",{children:[Object(F.jsx)(K.a,{type:"switch",label:"Show Matches Only",checked:N.MatchesOnly,onChange:function(e){N.MatchesOnly=e.target.checked,e.target.checked&&(N.NonMatchesOnly=!e.target.checked),M(Object(o.a)({},N))},id:"matchesOnly",inline:!0}),Object(F.jsx)(K.a,{type:"switch",label:"Show Non-Matches Only",checked:N.NonMatchesOnly,onChange:function(e){e.target.checked&&(N.MatchesOnly=!e.target.checked),N.NonMatchesOnly=e.target.checked,M(Object(o.a)({},N))},id:"nonMatchesOnly",inline:!0}),Object(F.jsx)(K.a,{type:"switch",label:"Fetch Full Images",checked:I,onChange:function(e){E(e.target.checked)},id:"fetchFull",inline:!0}),Object(F.jsx)(K.a,{type:"switch",label:"Compare Images on Top",checked:Y,onChange:function(e){z(e.target.checked)},id:"showOnTop",inline:!0}),Object(F.jsx)(K.a,{type:"switch",label:"Differential Image (first two, red color)",checked:U,onChange:function(e){Z(e.target.checked)},id:"showDifference",inline:!0})]})]}),Y?Object(F.jsxs)("div",{children:[Object(F.jsx)("div",{className:"row",children:Object(F.jsx)("div",{className:"col d-flex justify-content-center",children:Object(F.jsx)("div",{className:"compare-container",children:U?ee:null})})}),Object(F.jsx)("div",{className:"row",children:Object(F.jsx)("div",{className:"col d-flex justify-content-center",children:Object(F.jsx)("div",{className:"compare-container",children:D.map((function(e){return Object(F.jsx)("div",{className:"compare-inner",style:{opacity:e.opacity},children:e.image},e.id)}))})})}),Object(F.jsx)("div",{className:"row",children:Object(F.jsx)("div",{className:"col d-flex justify-content-center",children:Object(F.jsx)("div",{className:"container",children:D.map((function(e,t){return Object(F.jsx)("div",{className:"row justify-content-center",children:Object(F.jsx)("div",{className:"col-5",children:Object(F.jsxs)("div",{className:"row op-bordered justify-content-center",children:[Object(F.jsx)("div",{className:"col-5",children:"".concat(t,": A: ").concat(e.archivePk,", I: ").concat(e.imagePk)}),Object(F.jsx)("div",{className:"col-6",children:Object(F.jsx)(Q.a,{value:100*e.opacity,onChange:function(t){return function(e,t){var n=Object(s.a)(D),a=n.findIndex((function(t){return t.id===e.id}));if(-1!==a){var c=Object(o.a)({},n[a]);c.opacity=t/100,n[a]=c,L(n)}}(e,t)}})}),Object(F.jsx)("div",{className:"col-1 d-flex justify-content-center",children:Object(F.jsx)("button",{type:"button",className:"btn btn-primary btn-sm rounded-circle mx-0",onClick:function(){return function(e){var t=D.filter((function(t){return t.id!==e.id}));L(t)}(e)},children:"X"})})]})})},e.id)}))})})}),Object(F.jsx)("div",{className:"row",children:Object(F.jsx)("div",{className:"col d-flex justify-content-center",children:Object(F.jsx)("button",{type:"button",className:"btn btn-primary btn-sm",onClick:function(){L([])},children:"Clear"})})})]}):null,Object(F.jsx)(T,{data:n,archives:x,loading:ce,showMatchesOnly:N.MatchesOnly,showNonMatchesOnly:N.NonMatchesOnly,fetchFull:I,showImagesOnTop:Y,handleAddImage:function(e,t,n){var a={id:"".concat(t,"-").concat(n),image:e,opacity:1,archivePk:t,imagePk:n};L([].concat(Object(s.a)(D),[a]))}})]})})},H=function(e){e&&e instanceof Function&&n.e(3).then(n.bind(null,122)).then((function(t){var n=t.getCLS,a=t.getFID,c=t.getFCP,r=t.getLCP,i=t.getTTFB;n(e),a(e),c(e),r(e),i(e)}))};i.a.render(Object(F.jsx)(c.a.StrictMode,{children:Object(F.jsx)(Z,{})}),document.getElementById("root")),H()},67:function(e,t,n){},78:function(e,t){},80:function(e,t,n){},83:function(e,t,n){}},[[113,1,2]]]);
//# sourceMappingURL=main.7cb91e2d.chunk.js.map